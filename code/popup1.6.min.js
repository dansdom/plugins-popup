/*
	jQuery Popup Plugin 
	Copyright (c) 2011 Daniel Thomson
	
	Licensed under the MIT license:
	http://www.opensource.org/licenses/mit-license.php
*/

(function(a){a.fn.popup=function(c){var b=a.extend(true,{},{transparentLayer:true,transparentOpacity:70,gallery:false,galleryCounter:false,titleHeight:30,controlHeight:40,imageDesc:false,autoSize:true,boxWidth:400,boxHeight:300,centerImage:true,shadowLength:42,transition:500,popupID:"popupBox",contentClass:"popupContent",closeBox:"popupClose",centerOnResize:true,loaderPath:"loader.gif"},c);this.each(function(){var d=a(this);a(d).click(function(){d.boxSrc=a(this).attr("name");d.fragment=a(d.boxSrc); d.galleryTitle=a(this).attr("title");d.imageDesc=a(this).attr("longdesc");a.fn.popup.createBox(b);var f=a.fn.popup.findScreenPos();d.winY=f.winY;d.winX=f.winX;d.scrY=f.scrY;d.scrX=f.scrX;a.fn.popup.isContentImage(d)?a.fn.popup.displayImage(d,b):a.fn.popup.styleNodeBox(d,b);return false})});return this};a.fn.popup.findScreenPos=function(){var c={},b=a(window);c.winY=b.height();c.winX=b.width();c.scrY=b.scrollTop();c.scrX=b.scrollLeft();return c};a.fn.popup.createBox=function(c){var b,d,f=a(window); if(a("#"+c.popupID).length===0){b='<div id="'+c.popupID+'"><table cellpadding="0" cellspacing="0"><tbody><tr class="popupTop"><td class="popupTL corner pngbg"></td><td class="popupTM pngbg"></td><td class="popupTR corner pngbg"></td></tr><tr class="popupMid"><td class="popupML pngbg"></td><td class="'+c.contentClass+'"></td><td class="popupMR pngbg"></td></tr><tr class="popupBot"><td class="popupBL corner pngbg"></td><td class="popupBM pngbg"></td><td class="popupBR corner pngbg"></td></tr></tbody></table></div>'; if(a.browser.msie)if(a.browser.version=="6.0")b='<div id="'+c.popupID+'"><table cellpadding="0" cellspacing="0"><tbody><tr class="popupTop"><td class="popupTL corner pngbg"><div></div></td><td class="popupTM pngbg"><div></div></td><td class="popupTR corner pngbg"><div></div></td></tr><tr class="popupMid"><td class="popupML pngbg"><div></div></td><td class="'+c.contentClass+'"></td><td class="popupMR pngbg"><div></div></td></tr><tr class="popupBot"><td class="popupBL corner pngbg"><div></div></td><td class="popupBM pngbg"><div></div></td><td class="popupBR corner pngbg"><div></div></td></tr></tbody></table></div>'; a("body").append(b);a("#"+c.popupID).css("display","none")}if(c.transparentLayer===true&&a(".transparency").length===0){b='<div class="transparency" style="z-index:99;background:#000;opacity:'+c.transparentOpacity/100+";filter:alpha(opacity = "+c.transparentOpacity+');top:0;left:0;position:absolute"></div>';a("body").append(b);f.unbind();f.scroll(function(){d=a.fn.popup.findScreenPos();a(".transparency").css({height:d.winY+d.scrY,width:d.winX+d.scrX})});f.resize(function(){d=a.fn.popup.findScreenPos(); a(".transparency").css({height:d.winY+d.scrY,width:d.winX+d.scrX})})}c.transparentLayer===false&&a(".transparency").length>0&&a(".transparency").remove();document.onkeydown=function(e){var g;if(window.event)g=window.event.keyCode;else if(e)g=e.which;if(g==27){a("#"+c.popupID).stop().fadeOut("slow").css("display","none");a(".transparency").fadeOut("slow")}};a(".transparency").click(function(){a(this).fadeOut("slow");a("#"+c.popupID).fadeOut("slow")});a("#"+c.popupID+" ."+c.contentClass).children().remove(); d=a.fn.popup.findScreenPos();a(".transparency").css({display:"block",filter:"alpha(opacity = "+c.transparentOpacity+")",opacity:c.transparentOpacity/100,height:d.winY+d.scrY,width:d.winX+d.scrX})};a.fn.popup.styleBox=function(c,b,d,f){var e="#"+b.popupID,g="."+b.contentClass+" img",h,j,i,k,l,m,n;if(f){a(g).attr("src",f.src);a(g).attr("height",d.imgHeight);a(g).attr("width",d.imgWidth)}if(d){f=d.imgHeight+b.titleHeight+b.controlHeight;g=d.imgWidth;if(b.autoSize===false){f=b.boxHeight+b.titleHeight+ b.controlHeight;g=b.boxWidth}}else{f=b.boxHeight;g=b.boxWidth}h=g+b.shadowLength*2;j=f+b.shadowLength*2;i=a.fn.popup.centerBox(c,h,j);c=i.leftPos;k=i.topPos;b.centerOnResize===true&&a(window).resize(function(){l=a.fn.popup.findScreenPos();i=a.fn.popup.centerBox(l,h,j);a(e).css({top:i.topPos,left:i.leftPos})});if(a(e).css("display")==="block"&&d&&b.autoSize===true){m=parseFloat(a(e).css("height"))-b.shadowLength*2-(b.titleHeight+b.controlHeight);n=parseFloat(a(e).css("width"))-b.shadowLength*2;a(e+ " .galleryTitle").css({height:b.titleHeight+"px"});a(e+" .galleryControls").css({height:b.controlHeight+"px",overflow:"hidden"});a(e+" img").css({height:m+"px",width:n+"px"});a(e+" .imgPane").css({width:"100%"});a(e+" img").animate({height:d.imgHeight+"px",width:d.imgWidth+"px"},{queue:false,duration:b.transition});a(e).animate({height:j+"px",width:h+"px",left:c,top:k},{queue:false,duration:b.transition});a(e+" .imgPane").animate({height:f-b.titleHeight-b.controlHeight+"px"},{queue:false,duration:b.transition}); a(e+" .popupContent").animate({height:f+"px",width:g+"px"},{queue:false,duration:b.transition});a(e+" .popupTM, "+e+" .popupBM").animate({width:d.imgWidth+"px"},{queue:false,duration:b.transition})}else{a(e).css({height:j,width:h,position:"absolute","z-index":100,overflow:"hidden"});a(e+" .imgPane").css({height:f-b.titleHeight-b.controlHeight});a(e+" .popupContent").css({height:f,width:g});a(e+" .popupML div, "+e+" .popupMR div").css({height:f});a(e+" .galleryTitle").css({height:b.titleHeight,overflow:"hidden"}); a(e+" .galleryControls").css({height:b.controlHeight,overflow:"hidden"});a(e+" .corner").css({height:b.shadowLength,width:b.shadowLength});a(e+" .popupTM").css({height:b.shadowLength,width:g});a(e+" .popupBM").css({height:b.shadowLength,width:g});a(e).css({left:c,top:k})}a(e).fadeIn("slow");a(".pngbg div").addClass("popupPng")};a.fn.popup.centerBox=function(c,b,d){this.leftPos=(c.winX-b)/2+c.scrX;this.topPos=(c.winY-d)/2+c.scrY;if(this.topPos<0)this.topPos=0;if(this.leftPos<0)this.leftPos=0;return this}; a.fn.popup.isContentImage=function(c){c=c.boxSrc.split(".");switch(c[c.length-1]){case "jpg":c=true;break;case "gif":c=true;break;case "png":c=true;break;case "bmp":c=true;break;default:c=false}return c};a.fn.popup.displayImage=function(c,b){var d="#"+b.popupID+" ."+b.contentClass;a(d).append('<div class="imgPane"><img src="'+b.loaderPath+'" width="" height="" alt="" /></div>');b.imageDesc===true&&a(".imgPane").css("position","relative").append('<div class="imageDesc" style="position:absolute;bottom:0;left:0;width:100%;background:#000;opacity:0.8;filter:alpha(opacity = 80);">'+ c.imageDesc+"</div>");if(b.autoSize===false&&b.centerImage===true){a(d+" .imgPane").prepend("<span style='display:inline-block;height:"+b.boxHeight+"px;line-height:"+b.boxHeight+"px;width:1px'>&nbsp;</span>");a(d+" .imgPane").css({"line-height":b.boxHeight,"text-align":"center"});a(d+" .imgPane img").css({display:"inline","vertical-align":"middle"})}if(b.gallery===true)if(c.galleryTitle!==false){a(d).append('<div class="galleryControls"><ul><li><a href="" class="prev">previous</a></li><li><a href="" class="next">next</a></li></ul></div>'); a(d).prepend('<div class="galleryTitle"><h2>'+c.galleryTitle+'</h2><a href="" class="'+b.closeBox+'">close</a></div>');if(b.galleryCounter===true){var f=a("*[title='"+c.galleryTitle+"']").index(c)+1,e=a("*[title='"+c.galleryTitle+"']").length+1;a(d).find(".galleryControls").append("<p class='galleryCounter'>Displaying "+f+" of "+e+"</p>")}}else a(d).prepend('<div class="galleryTitle"><a href="" class="'+b.closeBox+'">close</a></div>');var g=new Image,h={};g.onload=function(){h.imgHeight=g.height; h.imgWidth=g.width;a.fn.popup.styleBox(c,b,h,g)};g.src=c.boxSrc;a.fn.popup.addCloseButton(c,b);a.fn.popup.addGalleryControls(c,b)};a.fn.popup.styleNodeBox=function(c,b){a("#"+b.popupID+" ."+b.contentClass).append('<div class="galleryTitle"><a href="" class="'+b.closeBox+'">close</a></div>');a("#"+b.popupID+" ."+b.contentClass).append(c.fragment);a("#"+b.popupID+" ."+b.contentClass+" "+c.boxSrc).css("display","block");a.fn.popup.styleBox(c,b);a.fn.popup.addCloseButton(c,b)};a.fn.popup.addGalleryControls= function(c,b){a("#"+b.popupID+" .next").click(function(){a.fn.popup.cycleImage(c,b,1);return false});a("#"+b.popupID+" .prev").click(function(){a.fn.popup.cycleImage(c,b,-1);return false});document.onkeydown=function(d){var f;if(window.event)f=window.event.keyCode;else if(d)f=d.which;if(f==39){a(document).unbind();a("#"+b.popupID+" .next").click()}else if(f==37){a(document).unbind();a("#"+b.popupID+" .prev").click()}f==27&&a.fn.popup.closeBox(c,b)}};a.fn.popup.addCloseButton=function(c,b){a("#"+b.popupID+ " ."+b.closeBox).click(function(){a.fn.popup.closeBox(c,b);return false})};a.fn.popup.closeBox=function(c,b){a("#"+b.popupID).stop().fadeOut("slow").css("display","none");a("#"+b.popupID).remove();a(".transparency").fadeOut("slow")};a.fn.popup.cycleImage=function(c,b,d){var f=a("*[title='"+c.galleryTitle+"']").index(c);b=a("*[title='"+c.galleryTitle+"']").length;d=f+d;if(d<0)d=b-1;if(d==b)d=0;a("*[title='"+c.galleryTitle+"']:eq("+d+")").click()}})(jQuery);